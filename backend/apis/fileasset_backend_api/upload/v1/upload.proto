syntax = "proto3";
package fileasset_backend_api.upload.v1;
option go_package = "fileasset_backend_api/upload/v1";

/*
  整体说明：
  1. 具体的上传业务接口时，先获取上传文件地址返回给前端，指定模块名称、最大文件数量、文件类型、文件后缀、文件最大字节数、当前文件上传的对象、链接的有效时长
  2. 前端将文件上传到文件服务，得到文件标识，表单提交时上传文件标识
  3. 后端接口通过rpc验证文件标识，然后确认存储文件
  4. 文件管理服务会定时删除未确认的临时文件
  5. 文件是上传oss还是本地保存由文件服务管理

*/

// 文件上传服务
service UploadService{
  // 获取特定配置的上传key
  rpc FetchKey (FetchKeyRequest) returns (FetchKeyResponse) {}
  // 确认上传文件
  rpc Confirm(ConfirmRequest) returns (ConfirmResponse) {}
}

message FetchKeyRequest{
  string module = 1; // 模块标识
  uint32 max = 2;    // 最大数量
  uint32 size = 3;   // 文件最大字节
  repeated string types = 4; // 支持的类型
  repeated string extensions = 5; // 支持的后缀
  string target = 6;   // 此次上传的标识，相关图片存储在该标识下
  uint32 ttl = 7;      // url过期时间
}
message FetchKeyResponse{
  string key = 1;
}

message ConfirmRequest{
  repeated string file_id = 1;
}
message ConfirmResponse{
  bool success = 1;
}